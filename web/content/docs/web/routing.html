<!DOCTYPE html>
<html>
	<head>
  <meta charset="utf-8">  
  <meta name="author" content="dadi.co">  
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Welcome</title>
  <link rel="stylesheet" type="text/css" href="/css/main.css">
</head>

	<body>

	  <header class="c-header c-header--acollapsed">
  <div class="c-header__inner-wrapper u-cols">
    <div class="u-col u-col--1-1 u-col--2-3@medium">
      <a href="/">
        <img class="c-header__logo" src="/public/assets/img/dadi.png" alt="DADI">
      </a>

      <h2 class="c-header__title">Developer support</h2>
      <p class="c-header__subtitle">Tutorials and documentation</p>    
    </div>

    <div class="c-header__top u-col u-col--1-1 u-col--1-3@medium">
      <ul class="c-header__links">
        <li class="c-header__link">
          <a href="http://twitter.com/dadi">@DADI</a>
        </li>
        <li class="c-header__link">
          <a href="mailto:dev@dadi.tech">dev@dadi.tech</a>
        </li>
      </ul>

      
    </div>    

    
      <div class="u-col u-col--1-1">
        <div class="c-combo">
  <label class="c-combo__item c-combo__item--expand c-text-field-container">
    <span class="c-text-field__icon fa fa-search"></span>
    <input class="c-text-field" type="text" placeholder="Search our help centre…" />
  </label>
  <button class="c-combo__item c-button c-button--blue" type="submit">Search</button>
</div>
      </div>
    
  </div>
</header>

	  <h2 id="routing">Routing</h2>

<p>Routing allows you to define URL endpoints for your application and control how Web responds to client requests.</p>

<ul>
  <li><a href="#basic-routing">Basic Routing</a></li>
  <li><a href="#page-routing">Page Routing</a>
    <ul>
      <li>Dynamic route segments and named parameters
        <ul>
          <li><a href="#optional-parameters">Optional Parameters</a></li>
          <li><a href="#parameter-format">Parameter Format</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#multiple-route-pages">Multiple Route Pages</a></li>
  <li><a href="#route-priority">Route Priority</a></li>
  <li><a href="#route-validation">Route Validation</a>
    <ul>
      <li><a href="#parameter-validation">Parameter Validation</a>
        <ul>
          <li>Preloaded data (<code class="highlighter-rouge">preload</code>)</li>
          <li>Static array test (<code class="highlighter-rouge">in</code>)</li>
          <li>Datasource lookup (<code class="highlighter-rouge">fetch</code>)</li>
        </ul>
      </li>
      <li>[Route Constraint Functions]
        <ul>
          <li>Constraint Datasources (deprecated)</li>
        </ul>
      </li>
      <li><a href="#template-url-building">Template URL Building</a></li>
      <li><a href="#using-request-parameters">Using Request Parameters</a></li>
    </ul>
  </li>
  <li><a href="#url-rewriting-and-redirects">URL Rewriting and Redirects</a>
    <ul>
      <li>forceLowerCase</li>
      <li>forceTrailingSlash</li>
      <li>stripIndexPages</li>
      <li>URL Rewrites File</li>
    </ul>
  </li>
  <li><a href="#migrating-to-version-1-7-0">Migrating to Version 1.7.0</a></li>
</ul>

<h3 id="basic-routing">Basic Routing</h3>

<p>Adding routes provides URLs for interacting with the application. A route specified as <code class="highlighter-rouge">/contact-us</code>, for example, will make a URL available to your end users as <code class="highlighter-rouge">http://www.example.com/contact-us</code>.</p>

<h3 id="page-routing">Page Routing</h3>

<p>For every page added to your application, a <code class="highlighter-rouge">route</code> is created by default. A page’s default route is a value matching the page name. For example if the page name is <code class="highlighter-rouge">books</code> the page will be available in the browser at <code class="highlighter-rouge">/books</code>.</p>

<p>To make the <code class="highlighter-rouge">books</code> page reachable via a different URL, simply add (or modify) the page’s <code class="highlighter-rouge">routes</code> property:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"routes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/books/all"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p><strong>Note: for DADI Web prior to version 1.7.0</strong></p>

<p>In earlier versions of DADI Web, the syntax for defining routes was slightly different. Instead of a <code class="highlighter-rouge">routes</code> property defined as an array, we used a <code class="highlighter-rouge">route</code> property (notice the plural vs singular forms) containing an array of paths. This format is still valid in versions prior to 1.7.0. In 1.7.0 and above, this format will be resolved at startup to match the required format.</p>

<p>For example, starting in 1.7.0, a value such as <code class="highlighter-rouge">"route": { "path": "/books" }</code> will be resolved at startup to <code class="highlighter-rouge">"routes": [ { "path": "/books" } ]</code>.</p>

<p>Should you have existing page routes in this format <code class="highlighter-rouge">"route": "/books"</code>, <a href="#migrating-to-version-1.7.0">please see the note</a> at the end of this page.</p>

<h4 id="dynamic-route-segments-and-named-parameters">Dynamic route segments and named parameters</h4>

<p>Routes may contain dynamic segments or named parameters which are resolved from the request URL and can be utilised by the datasources and events attached to the page.</p>

<p>A route segment with a colon at the beginning indicates a dynamic segment which will match any value. For example, a page with the route <code class="highlighter-rouge">/books/:title</code> will be loaded for any request matching the format. DADI Web will extract the <code class="highlighter-rouge">:title</code> parameter and add it to the <code class="highlighter-rouge">req.params</code> object, making it available for use in the page’s attached datasources and events.</p>

<p>The following URLs match the above route, with the segment defined by <code class="highlighter-rouge">:title</code> extracted, placed into <code class="highlighter-rouge">req.params</code> and accessible via the property <code class="highlighter-rouge">title</code>.</p>

<table>
  <thead>
    <tr>
      <th>URL</th>
      <th>Named Parameter <code class="highlighter-rouge">:title</code></th>
      <th>Request Parameters <code class="highlighter-rouge">req.params</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>/books/war-and-peace</td>
      <td><code class="highlighter-rouge">war-and-peace</code></td>
      <td><code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="err">title:</span><span class="w"> </span><span class="nt">"war-and-peace"</span><span class="w"> </span><span class="err">}</span></code></td>
    </tr>
    <tr>
      <td>/books/sisters-brothers</td>
      <td><code class="highlighter-rouge">sisters-brothers</code></td>
      <td><code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="err">title:</span><span class="w"> </span><span class="nt">"sisters-brothers"</span><span class="w"> </span><span class="err">}</span></code></td>
    </tr>
  </tbody>
</table>

<h5 id="optional-parameters">Optional Parameters</h5>

<p>Parameters can be made optional by adding a question mark <code class="highlighter-rouge">?</code>.</p>

<p>For example the route <code class="highlighter-rouge">/books/:page?</code> will match requests in both the following formats:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">URL</th>
      <th style="text-align: left">Matched?</th>
      <th style="text-align: left">Named Parameters</th>
      <th>Request Parameters <code class="highlighter-rouge">req.params</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">/books</td>
      <td style="text-align: left">Yes</td>
      <td style="text-align: left"> </td>
      <td><code class="highlighter-rouge"><span class="p">{}</span></code></td>
    </tr>
    <tr>
      <td style="text-align: left">/books/2</td>
      <td style="text-align: left">Yes</td>
      <td style="text-align: left"><code class="highlighter-rouge">:page</code></td>
      <td><code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="err">page:</span><span class="w"> </span><span class="nt">"2"</span><span class="w"> </span><span class="err">}</span></code></td>
    </tr>
  </tbody>
</table>

<h5 id="parameter-format">Parameter Format</h5>

<p>Specifying a format for a parameter can help Web identify the correct route to use. We can use the same example as above, where the URL has an optional <code class="highlighter-rouge">page</code> parameter. If we add a regular expression to this parameter indicating that it should only match numbers, any URL that doesn’t contain numbers in this segment will not match the route.</p>

<p><strong>Example</strong></p>

<p>The route <code class="highlighter-rouge">/books/:page(\\d+)</code> will only match a URL that has <code class="highlighter-rouge">books</code> in the first segment and a number in the second segment:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">URL</th>
      <th style="text-align: left">Matched?</th>
      <th style="text-align: left">Named Parameters</th>
      <th>Request Parameters <code class="highlighter-rouge">req.params</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">/books/war-and-peace</td>
      <td style="text-align: left">No</td>
      <td style="text-align: left"> </td>
      <td> </td>
    </tr>
    <tr>
      <td style="text-align: left">/books/2</td>
      <td style="text-align: left">Yes</td>
      <td style="text-align: left"><code class="highlighter-rouge">:page</code></td>
      <td><code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="err">page:</span><span class="w"> </span><span class="nt">"2"</span><span class="w"> </span><span class="err">}</span></code></td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p><strong>Note:</strong> DADI Web uses the <a href="https://github.com/pillarjs/path-to-regexp">Path to Regexp</a> library when parsing routes and parameters. More information on parameter usage can be found in the Github repository.</p>
</blockquote>

<h3 id="multiple-route-pages">Multiple Route Pages</h3>

<p>The <code class="highlighter-rouge">routes</code> property makes it easy for you to define “multiple route” pages, where one page specification can respond to requests for multiple routes.</p>

<p><strong>DADI Web versions &gt;= 1.7.0</strong></p>

<p>DADI Web 1.7.0 introduced a more explicit way of specifying multiple routes per page . The <code class="highlighter-rouge">route</code> property has been replaced with <code class="highlighter-rouge">routes</code> which should be an Array of route objects.</p>

<p>Each route object must contain, at the very least, a <code class="highlighter-rouge">path</code> property. At startup, Web adds the value of each <code class="highlighter-rouge">path</code> property to an internal collection of routes for matching incoming requests.</p>

<p>In this example, the same page (and therefore it’s template) will be loaded for requests matching any of the formats specified by the <code class="highlighter-rouge">path</code> properties:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"routes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/movies/:title"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/movies/news/:title?/"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/movies/news/:page?/"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p><strong>DADI Web versions &lt; 1.7.0</strong></p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"route"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"paths"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"/people"</span><span class="p">,</span><span class="w"> </span><span class="s2">"/people/:id"</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h3 id="route-priority">Route Priority</h3>

<p>DADI Web sorts your routes into a priority order so that the most likely matches are easier to find.</p>

<ul>
  <li>
    <p>In Web, the most important parts of a route are the static segments, or rather the non-dynamic segments, for example <code class="highlighter-rouge">/books</code>. The more static segments in a route the its priority.</p>
  </li>
  <li>
    <p>The second most important parts are the mandatory dynamic segments, for example <code class="highlighter-rouge">/:title</code>.</p>
  </li>
  <li>
    <p>The least important parts are the optional dynamic segments, for example <code class="highlighter-rouge">/:year?</code>.</p>
  </li>
  <li>
    <p>Any route with a <code class="highlighter-rouge">page</code> parameter gets a slight edge, with 1 point being added to its priority.</p>
  </li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Path</th>
      <th style="text-align: left">Priority</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">/movies/news/:page(\\d+)?/</code></td>
      <td style="text-align: left">12</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">/movies/reviews/:page(\\d+)?</code></td>
      <td style="text-align: left">12</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">/movies/features/:page(\\d+)?/</code></td>
      <td style="text-align: left">12</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">/movies/news/:title?/</code></td>
      <td style="text-align: left">11</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">/movies/features/:title?/</code></td>
      <td style="text-align: left">11</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">/movies/reviews/</code></td>
      <td style="text-align: left">10</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">/movies/:title/:page(\\d+)?</code></td>
      <td style="text-align: left">9</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">/movies/:title/:content?</code></td>
      <td style="text-align: left">8</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">/movies/</code></td>
      <td style="text-align: left">5</td>
    </tr>
  </tbody>
</table>

<h3 id="route-validation">Route Validation</h3>

<p>An application may have more than one route that matches a particular URL, for example two routes that each have one dynamic segment:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/:genres
/:categories
</code></pre>
</div>
<p>In this case it is possible to provide DADI Web with some rules for determining the correct routes based on the parameters in the request. Parameter checks currently supported are:</p>

<ul>
  <li><code class="highlighter-rouge">preload</code> - tests the parameter value exists in a set of preloaded data</li>
  <li><code class="highlighter-rouge">in</code> - tests the parameter value exists in an array of static values</li>
  <li><code class="highlighter-rouge">fetch</code> - performs a datasource lookup using the parameter value as a filter</li>
</ul>

<h4 id="parameter-validation">Parameter Validation</h4>

<h5 id="preloaded-data-preload">Preloaded data (<code class="highlighter-rouge">preload</code>)</h5>

<p>To validate parameters against preloaded data, you first need to configure Web to preload some data. Add a block to the <a href="configuration.md">main configuration</a> file like the example below, using your datasource names in place of “channels”:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"preload"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"channels"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"routes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/:channel/news/"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"param"</span><span class="p">:</span><span class="w"> </span><span class="s2">"channel"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"preload"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"channels"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h5 id="static-array-test-in">Static array test (<code class="highlighter-rouge">in</code>)</h5>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"routes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/movies/:title/:subPage?/"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"param"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subPage"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"in"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"review"</span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h5 id="datasource-lookup-fetch">Datasource lookup (<code class="highlighter-rouge">fetch</code>)</h5>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"routes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/movies/:title/:content?/"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"fetch"</span><span class="p">:</span><span class="w"> </span><span class="s2">"movies"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h4 id="route-constraint-functions">Route Constraint Functions</h4>

<p>In the case of ambiguous routes it is possible to provide DADI Web with a constraint function to check each matching route against some business logic or existing data.</p>

<blockquote>
  <p>Returning <code class="highlighter-rouge">true</code> from a constraint instructs DADI Web that this is the correct route, the attached datasources and events should be run and the page displayed.</p>
</blockquote>

<blockquote>
  <p>Returning <code class="highlighter-rouge">false</code> from a constraint instructs DADI Web to try the next matching route (or return a 404 if there are no further matching routes).</p>
</blockquote>

<p>Constraints are added as a route property in the page specification file:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"routes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/:people"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"constraint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nextIfNotPeople"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>To add constraint functions, create a file in the <code class="highlighter-rouge">routes</code> folder (by default configured as <code class="highlighter-rouge">app/routes</code>). The file <strong>MUST</strong> be named <code class="highlighter-rouge">constraints.js</code>.</p>

<p>In the following example the route has a dynamic parameter <code class="highlighter-rouge">subPage</code>. The constraint function <code class="highlighter-rouge">nextIfNewsOrFeatures</code> will check the value of the <code class="highlighter-rouge">subPage</code> parameter and return <code class="highlighter-rouge">false</code> if it matches “news” or “features”, indicating to DADI Web that the next matching route should be tried (or a 404 returned if there are no further matching routes).</p>

<p><em>app/pages/movies.json</em></p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"routes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/movies/:subPage"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"constraint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nextIfNewsOrFeatures"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p><em>app/routes/constraints.js</em></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">nextIfNewsOrFeatures</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>  
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">subPage</span> <span class="o">===</span> <span class="s1">'news'</span> <span class="o">||</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">subPage</span> <span class="o">===</span> <span class="s1">'features'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<h5 id="constraint-datasources">Constraint Datasources</h5>

<blockquote>
  <p><strong>Note:</strong> Deprecated in Version 1.7.0</p>
</blockquote>

<p>An existing datasource can be used as the route constraint. The specified datasource must exist in <code class="highlighter-rouge">datasources</code> (by default configured as <code class="highlighter-rouge">app/datasources</code>). The following examples have some missing properties for brevity.</p>

<p>app/pages/books.json</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"route"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"paths"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"/:genre"</span><span class="p">],</span><span class="w">
    </span><span class="nt">"constraint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"genres"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>app/datasources/genres.json</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"datasource"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"genres"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Genre datasource"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0/library/genres"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"requestParams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nt">"param"</span><span class="p">:</span><span class="w"> </span><span class="s2">"genre"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"title"</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>
</div>

<p>In the above example a request for <code class="highlighter-rouge">http://www.example.com/crime</code> will call the <code class="highlighter-rouge">genres</code> datasource, using the <code class="highlighter-rouge">requestParams</code> to supply a filter to the endpoint. The request parameter <code class="highlighter-rouge">:genre</code> will be set to <code class="highlighter-rouge">crime</code> and the resulting datasource endpoint will become:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/1.0/library/genres?filter={"title":"crime"}
</code></pre>
</div>

<p>If there is a result for this datasource query, the constraint will return <code class="highlighter-rouge">true</code>, otherwise <code class="highlighter-rouge">false</code>.</p>

<h4 id="template-url-building">Template URL Building</h4>

<p>Using <code class="highlighter-rouge">toPath()</code>:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'dadi-web'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">getComponent</span><span class="p">(</span><span class="s1">'people'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">page</span><span class="p">.</span><span class="nx">toPath</span><span class="p">({</span> <span class="na">id</span><span class="p">:</span> <span class="s1">'1234'</span> <span class="p">});</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>"/person/1234"
</code></pre>
</div>

<h4 id="using-request-parameters">Using Request Parameters</h4>

<p>See <a href="datasource_specification.md">Datasource Specification</a> for more information regarding the use of named parameters in datasource queries.</p>

<h3 id="url-rewriting-and-redirects">URL Rewriting and Redirects</h3>

<h4 id="forcelowercase">forceLowerCase</h4>

<p>With this property set to true, Web converts incoming URLs to lowercase and sends a 301 Redirect response to the browser with the lowercased version of the URL.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"forceLowerCase"</span><span class="err">:</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre>
</div>

<h4 id="forcetrailingslash">forceTrailingSlash</h4>

<p>With this property set to true, Web adds a trailing slash to incoming URLs and sends a 301 Redirect response to the browser with the new version of the URL.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"forceTrailingSlash"</span><span class="err">:</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre>
</div>

<h4 id="stripindexpages">stripIndexPages</h4>

<p>This property accepts an array of filenames to remove from URLs. Useful for when you’re migrating from another system and search engines may have indexed URLs containing legacy files. For example <code class="highlighter-rouge">http://legacy-web.example.com/index.php</code></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"stripIndexPages"</span><span class="err">:</span> <span class="p">[</span><span class="s2">"index.php"</span><span class="p">,</span> <span class="s2">"default.aspx"</span><span class="p">]</span>
<span class="p">}</span>
</code></pre>
</div>

<h4 id="url-rewrites-file">URL Rewrites File</h4>
<div class="highlighter-rouge"><pre class="highlight"><code>^(.*[^/])$ $1/ [R=301,L]
^/books/(.*)$ /books?authorId=$1 [R=301,L]
</code></pre>
</div>

<h3 id="migrating-to-version-170">Migrating to Version 1.7.0</h3>

<p>To help you migrate your Web installation to v1.7.0, the router will inform you of any changes required to page specifications if the existing <code class="highlighter-rouge">route</code> property has not yet been modified.</p>

<p>Look out for console messages similar to the following:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>The `route` property for pages has been extended to provide better routing functionality.
Please modify the route property for page 'movies_news'. The schema should change to the below:

{
  "page": {
    "name": "movies_news",
    "description": "movies news",
    "language": "en"
  },
  "settings": {
    "cache": true
  },
  "datasources": [],
  "events": [],
  "routes": [
    {
      "path": "/movies/news/:furl?/"
    }
  ]
}
</code></pre>
</div>


	  <footer class="c-footer">
  <div class="u-cols u-wrapper">
    <div class="u-col u-col--1-2 u-col--1-4@medium u-padding">
      <h3 class="c-footer__title">Client engagement</h3>
      <p class="epsilon"><a href="mailto:makesomething@dadi.tech">makesomething@dadi.tech</a><br>
      +44 (0) 20 7205 2902</p>
    </div>
    <div class="u-col u-col--1-2 u-col--1-4@medium u-padding">
      <h3 class="c-footer__title">Media enquiries</h3>
      <p class="epsilon"><a href="mailto:press@dadi.tech">press@dadi.tech</a><br>
      +44 (0) 20 7205 2901</p>
    </div>
    <div class="u-col u-col--1-2 u-col--1-4@medium u-padding">
      <h3 class="c-footer__title">Careers</h3>
      <p class="epsilon"><a href="mailto:joinus@dadi.tech">joinus@dadi.tech</a><br>
      +44 (0) 20 7205 2903</p>
    </div>
    <div class="u-col u-col--1-2 u-col--1-4@medium u-padding">
      <h3 class="c-footer__title">Everything else</h3>
      <p class="epsilon"><a href="mailto:hi@dadi.tech">hi@dadi.tech</a><br>
      +44 (0) 20 7205 2900<br>
      <a href="http://twitter.com/dadi">@dadi</a></p>
    </div>
  </div>

  <div class="u-wrapper u-padding">
    <img src="/public/assets/img/dadi-full.png" height="24">
  </div>
</footer>

	</body>
</html>