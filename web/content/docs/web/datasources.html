<!DOCTYPE html>
<html>
	<head>
  <meta charset="utf-8">  
  <meta name="author" content="dadi.co">  
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Welcome</title>
  <link rel="stylesheet" type="text/css" href="/css/main.css">
</head>

	<body>

	  <header class="c-header c-header--acollapsed">
  <div class="c-header__inner-wrapper u-cols">
    <div class="u-col u-col--1-1 u-col--2-3@medium">
      <a href="/">
        <img class="c-header__logo" src="/public/assets/img/dadi.png" alt="DADI">
      </a>

      <h2 class="c-header__title">Developer support</h2>
      <p class="c-header__subtitle">Tutorials and documentation</p>    
    </div>

    <div class="c-header__top u-col u-col--1-1 u-col--1-3@medium">
      <ul class="c-header__links">
        <li class="c-header__link">
          <a href="http://twitter.com/dadi">@DADI</a>
        </li>
        <li class="c-header__link">
          <a href="mailto:dev@dadi.tech">dev@dadi.tech</a>
        </li>
      </ul>

      
    </div>    

    
      <div class="u-col u-col--1-1">
        <div class="c-combo">
  <label class="c-combo__item c-combo__item--expand c-text-field-container">
    <span class="c-text-field__icon fa fa-search"></span>
    <input class="c-text-field" type="text" placeholder="Search our help centre…" />
  </label>
  <button class="c-combo__item c-button c-button--blue" type="submit">Search</button>
</div>
      </div>
    
  </div>
</header>

	  <h2 id="datasources">Datasources</h2>

<h3 id="overview">Overview</h3>

<p>DADI Web.</p>

<ul>
  <li><a href="#datasource-specification">Datasource Specification</a></li>
  <li><a href="#caching">Caching</a></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>my-web/
  app/
    datasources/      
      books.json      # a datasource specification
    events/           
    pages/            
</code></pre>
</div>

<h3 id="datasource-specification">Datasource Specification</h3>

<h4 id="example-datasource-specification">Example datasource specification</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"datasource"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"books"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Books datasource"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0/library/books"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"paginate"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"sort"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="err">],</span><span class="w">
    </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"datasource"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"books"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Books datasource"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"remote"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"api.example.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="s2">"80"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0/library/books"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"caching"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"ttl"</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w">
      </span><span class="nt">"directory"</span><span class="p">:</span><span class="w"> </span><span class="s2">"./cache/web/"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="s2">"json"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"auth"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bearer"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"api.example.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="s2">"80"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tokenUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/token"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"clientId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"testClient"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"superSecret"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"paginate"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"sort"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"author_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w">
    </span><span class="nt">"requestParams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nt">"param"</span><span class="p">:</span><span class="w"> </span><span class="s2">"title"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"title"</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"datasource"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"books"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Books datasource"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"remote"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"api.example.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="s2">"80"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0/library/books"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"caching"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"ttl"</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w">
      </span><span class="nt">"directory"</span><span class="p">:</span><span class="w"> </span><span class="s2">"./cache/web/"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="s2">"json"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"auth"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bearer"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"api.example.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="s2">"80"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tokenUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/token"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"clientId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"testClient"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"superSecret"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"paginate"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"sort"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"author_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w">
    </span><span class="nt">"requestParams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nt">"param"</span><span class="p">:</span><span class="w"> </span><span class="s2">"title"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"title"</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h4 id="property-description">Property Description</h4>

<h6 id="section-datasource">Section: <code class="highlighter-rouge">datasource</code></h6>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: left">Description</th>
      <th style="text-align: left">Default value</th>
      <th style="text-align: left">Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">key</td>
      <td style="text-align: left">Short identifier of the datasource. This value is used in the page specification files to attach a datasource</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">books</td>
    </tr>
    <tr>
      <td style="text-align: left">name</td>
      <td style="text-align: left">This is the name of the datasource, it will be displayed on the front-end of the gui</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">Books</td>
    </tr>
    <tr>
      <td style="text-align: left">paginate</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">true</td>
      <td style="text-align: left">true</td>
    </tr>
    <tr>
      <td style="text-align: left">count</td>
      <td style="text-align: left">Number of items to return from the endpoint per page. If set to ‘0’ then all results will be returned</td>
      <td style="text-align: left">20</td>
      <td style="text-align: left">5</td>
    </tr>
    <tr>
      <td style="text-align: left">sort</td>
      <td style="text-align: left">A JSON object with fields to order the result set by</td>
      <td style="text-align: left">{} // unsorted</td>
      <td style="text-align: left"><code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">sort</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="err">title</span><span class="w"> </span><span class="err">ascending</span></code>, <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">sort</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="err">title</span><span class="w"> </span><span class="err">descending</span></code></td>
    </tr>
    <tr>
      <td style="text-align: left">filter</td>
      <td style="text-align: left">A JSON object containing a MongoDB query</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">{ “SaleDate” : { “$ne” : null} }</td>
    </tr>
    <tr>
      <td style="text-align: left">filterEvent</td>
      <td style="text-align: left">An event file to execute which will generate the filter to use for this datasource. The event must exist in the configured events path</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">“getBookFilter”</td>
    </tr>
    <tr>
      <td style="text-align: left">fields</td>
      <td style="text-align: left">Limits the fields to return in the result set</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">{ “title”: 1, “author”: 1 }</td>
    </tr>
    <tr>
      <td style="text-align: left">requestParams</td>
      <td style="text-align: left">An array of parameters the datasource can accept from the querystring</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">[ { “param”: “author”, “field”: “author_id” } ]</td>
    </tr>
  </tbody>
</table>

<h6 id="section-datasourcesource">Section: <code class="highlighter-rouge">datasource.source</code></h6>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: left">Description</th>
      <th style="text-align: left">Default value</th>
      <th style="text-align: left">Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">type</td>
      <td style="text-align: left">(optional) Determines whether the data is from a remote endpoint or local, static data</td>
      <td style="text-align: left">“remote”</td>
      <td style="text-align: left">“remote”, “static”</td>
    </tr>
    <tr>
      <td style="text-align: left">protocol</td>
      <td style="text-align: left">(optional) The protocol portion of an endpoint URI</td>
      <td style="text-align: left">“http”</td>
      <td style="text-align: left">“http”, “https”</td>
    </tr>
    <tr>
      <td style="text-align: left">host</td>
      <td style="text-align: left">(optional) The host portion of an endpoint URL</td>
      <td style="text-align: left">The main config value <code class="highlighter-rouge">api.host</code></td>
      <td style="text-align: left">“api.example.com”</td>
    </tr>
    <tr>
      <td style="text-align: left">port</td>
      <td style="text-align: left">(optional) The port portion of an endpoint URL</td>
      <td style="text-align: left">The main config value <code class="highlighter-rouge">api.port</code></td>
      <td style="text-align: left">“3001”</td>
    </tr>
    <tr>
      <td style="text-align: left">endpoint</td>
      <td style="text-align: left">The path to the endpoint which contains the data for this datasource</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">“/1.0/news/articles”</td>
    </tr>
  </tbody>
</table>

<h6 id="section-datasourcecaching">Section: <code class="highlighter-rouge">datasource.caching</code></h6>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: left">Description</th>
      <th style="text-align: left">Default value</th>
      <th style="text-align: left">Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">enabled</td>
      <td style="text-align: left">Sets caching enabled or disabled</td>
      <td style="text-align: left">enabled</td>
      <td style="text-align: left">enabled</td>
    </tr>
    <tr>
      <td style="text-align: left">ttl</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">directory</td>
      <td style="text-align: left">The directory to use for storing cache files, relative to the root of the application</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">”./cache”</td>
    </tr>
    <tr>
      <td style="text-align: left">extension</td>
      <td style="text-align: left">The file extension to use for cache files</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">“json”</td>
    </tr>
  </tbody>
</table>

<h6 id="section-datasourceauth">Section: <code class="highlighter-rouge">datasource.auth</code></h6>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: left">Description</th>
      <th style="text-align: left">Default value</th>
      <th style="text-align: left">Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">type</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">bearer</td>
    </tr>
    <tr>
      <td style="text-align: left">host</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">api.example.com</td>
    </tr>
    <tr>
      <td style="text-align: left">port</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">3000</td>
    </tr>
    <tr>
      <td style="text-align: left">tokenUrl</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">“/token”</td>
    </tr>
    <tr>
      <td style="text-align: left">credentials</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">{ “clientId”: “test123”, “secret”: “superSecret” }</td>
    </tr>
  </tbody>
</table>

<h4 id="passing-parameters-with-requestparams">Passing parameters with <code class="highlighter-rouge">requestParams</code></h4>

<p><code class="highlighter-rouge">requestParams</code> is an array of parameters that the datasource can accept from the querystring.<br />
Used in conjunction with the <code class="highlighter-rouge">route</code> property in the page specification, this allows<br />
filters to be generated for querying the collection.</p>

<p><strong>Page specification</strong></p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="s2">"route"</span><span class="err">:</span> <span class="p">{</span>
  <span class="s2">"path"</span><span class="err">:</span> <span class="s2">"/books/:title"</span>
<span class="p">}</span>
</code></pre>
</div>

<p><strong>Datasource specification</strong></p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="s2">"source"</span><span class="err">:</span> <span class="p">{</span>
  <span class="s2">"endpoint"</span><span class="err">:</span> <span class="s2">"1.0/library/books"</span>
<span class="p">},</span>
<span class="s2">"requestParams"</span><span class="err">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="s2">"field"</span><span class="p">:</span> <span class="s2">"title"</span><span class="p">,</span> <span class="s2">"param"</span><span class="p">:</span> <span class="s2">"title"</span> <span class="p">}</span>
<span class="p">]</span>
</code></pre>
</div>

<table>
  <thead>
    <tr>
      <th>field</th>
      <th>param</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>The collection field to filter on</td>
      <td>The request parameter to use as the value for the filter, This must match a named parameter in the page specification’s <code class="highlighter-rouge">route</code> property</td>
    </tr>
  </tbody>
</table>

<h6 id="for-example-given-a-collection-books-with-the-fields-id-title">For example, given a collection <code class="highlighter-rouge">books</code> with the fields <code class="highlighter-rouge">_id</code>, <code class="highlighter-rouge">title</code></h6>

<p>With the page route <code class="highlighter-rouge">/books/:title</code> and the above datasource configuration, DADI Web will extract the <code class="highlighter-rouge">:title</code> parameter from the URL and use it to query the <code class="highlighter-rouge">books</code> collection using the field <code class="highlighter-rouge">title</code>.</p>

<p>With a request to http://www.example.com/books/sisters-brothers, the named parameter <code class="highlighter-rouge">:title</code> is <code class="highlighter-rouge">sisters-brothers</code>. A filter query is constructed for DADI API using this value.</p>

<p>The query passed to the API is: <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"sisters-brothers"</span><span class="w"> </span><span class="p">}</span></code></p>

<table>
  <thead>
    <tr>
      <th>Page Route</th>
      <th>Datasource requestParams</th>
      <th>URL</th>
      <th>req.params</th>
      <th>Query</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">/books/:title</code></td>
      <td><code class="highlighter-rouge">"requestParams": [ { "param": "title", "field": "title" } ]</code></td>
      <td>http://www.example.com/books/sisters-brothers</td>
      <td><code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="err">'title':</span><span class="w"> </span><span class="err">'sisters-brothers'</span><span class="w"> </span><span class="p">}</span></code></td>
      <td><code class="highlighter-rouge">db.books.find({ 'title': 'sisters-brothers' })</code></td>
    </tr>
  </tbody>
</table>

<p>See <a href="https://github.com/dadi/web/blob/docs/docs/pages.md#routing">Routing</a> for detailed routing documentation.</p>

<h4 id="chaining-datasources">Chaining datasources</h4>

<p>It is often a requirement to query a datasource using data already loaded by another datasource. DADI Web supports this through the use of chained datasources. Chained datasources are executed after all non-chained datasources.</p>

<p>Add a <code class="highlighter-rouge">chained</code> property to the datasource that relies on data loaded by another datasource.</p>

<p><em>Simple field replacement</em></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="s2">"chained"</span><span class="err">:</span> <span class="p">{</span>
  <span class="s2">"datasource"</span><span class="err">:</span> <span class="s2">"books"</span><span class="p">,</span>              <span class="c1">// the primary (non-chained) datasource that this datasource relies on</span>
  <span class="s2">"outputParam"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"param"</span><span class="err">:</span> <span class="s2">"results.0.author_id"</span><span class="p">,</span>  <span class="c1">// the path to the value this datasource will use as a filter</span>
    <span class="s2">"field"</span><span class="err">:</span> <span class="s2">"_id"</span>                   <span class="c1">// the filter property to use for this datasource</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p><em>Filter replacement</em></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="s2">"filter"</span><span class="err">:</span> <span class="p">[</span><span class="s2">"{books}"</span><span class="p">,{</span><span class="s2">"$group"</span><span class="p">:{</span><span class="s2">"_id"</span><span class="p">:{</span><span class="s2">"genre"</span><span class="p">:</span><span class="s2">"$genre"</span><span class="p">}}}],</span>
<span class="s2">"chained"</span><span class="err">:</span> <span class="p">{</span>
  <span class="s2">"datasource"</span><span class="err">:</span> <span class="s2">"books"</span><span class="p">,</span>
  <span class="s2">"outputParam"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"param"</span><span class="err">:</span> <span class="s2">"results.0.genre_id"</span><span class="p">,</span>
    <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"Number"</span><span class="p">,</span>
    <span class="s2">"query"</span><span class="err">:</span> <span class="p">{</span><span class="s2">"$match"</span><span class="err">:</span><span class="p">{</span><span class="s2">"genre_id"</span><span class="err">:</span> <span class="s2">"{param}"</span><span class="p">}}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<table>
  <thead>
    <tr>
      <th>x</th>
      <th>x</th>
      <th>x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>datasource</td>
      <td>Should match the <code class="highlighter-rouge">key</code> property of the primary datasource.</td>
      <td> </td>
    </tr>
    <tr>
      <td>outputParam.param</td>
      <td>The <code class="highlighter-rouge">param</code> value specifies where to locate the output value in the results returned by the primary datasource.</td>
      <td> </td>
    </tr>
    <tr>
      <td>outputParam.field</td>
      <td>The <code class="highlighter-rouge">field</code> value should match the MongoDB field to be queried. The <code class="highlighter-rouge">type</code> value indicates how the <code class="highlighter-rouge">param</code> value should be treated (currently only “Number” is supported).</td>
      <td> </td>
    </tr>
    <tr>
      <td>outputParam.query</td>
      <td>The <code class="highlighter-rouge">query</code> property allows more advanced filtering, see below for more detail.</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h6 id="for-example">For example</h6>

<p>On a page that displays a car make and all it’s associated models, we have two datasources querying two collections, <strong>makes</strong> and <strong>models</strong>.</p>

<p>** Collections **</p>

<ul>
  <li><strong>makes</strong> has the fields <code class="highlighter-rouge">_id</code> and <code class="highlighter-rouge">name</code></li>
  <li><strong>models</strong> has the fields <code class="highlighter-rouge">_id</code>, <code class="highlighter-rouge">makeId</code> and <code class="highlighter-rouge">name</code></li>
</ul>

<p>** Datasources **</p>

<ul>
  <li>The primary datasource, <code class="highlighter-rouge">makes</code> (some properties removed for brevity)</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"datasource"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"makes"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="nt">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0/car-data/makes"</span><span class="w">
     </span><span class="p">},</span><span class="w">
     </span><span class="err">filter</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ford"</span><span class="w"> </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>The result of this datasource will be:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5596048644713e80a10e0290"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ford"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>To query the models collection based on the above data being returned, add a <code class="highlighter-rouge">chained</code> property to the models datasource specifying <code class="highlighter-rouge">makes</code> as the primary datasource:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"datasource"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"models"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="nt">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0/car-data/models"</span><span class="w">
     </span><span class="p">},</span><span class="w">
      </span><span class="nt">"chained"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"datasource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"makes"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"outputParam"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"param"</span><span class="p">:</span><span class="w"> </span><span class="s2">"results.0._id"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"makeId"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<p>In this scenario the <strong>models</strong> collection will be queried using the value of <code class="highlighter-rouge">_id</code> from the first document of the <code class="highlighter-rouge">results</code> array returned by the <strong>makes</strong> datasource.</p>

<p>If your query parameter must be passed to the endpoint as an integer, add a <code class="highlighter-rouge">type</code> property to the <code class="highlighter-rouge">outputParam</code> specifying <code class="highlighter-rouge">"Number"</code>.</p>
<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"datasource"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"models"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="nt">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0/car-data/models"</span><span class="w">
     </span><span class="p">},</span><span class="w">
     </span><span class="nt">"chained"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"datasource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"makes"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"outputParam"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"param"</span><span class="p">:</span><span class="w"> </span><span class="s2">"results.0._id"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Number"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"makeId"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h6 id="filter-replacement">Filter replacement</h6>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="s2">"filter"</span><span class="err">:</span> <span class="p">[</span><span class="s2">"{capRangeByUrlModel}"</span><span class="p">,{</span><span class="s2">"$group"</span><span class="p">:{</span><span class="s2">"_id"</span><span class="p">:{</span><span class="s2">"fuelType"</span><span class="p">:</span><span class="s2">"$fuelType"</span><span class="p">}}}],</span>
<span class="s2">"chained"</span><span class="err">:</span> <span class="p">{</span>
  <span class="s2">"datasource"</span><span class="err">:</span> <span class="s2">"capRangeByUrlModel"</span><span class="p">,</span>
  <span class="s2">"outputParam"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"param"</span><span class="err">:</span> <span class="s2">"results.0.capRanId"</span><span class="p">,</span>
    <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"Number"</span><span class="p">,</span>
    <span class="s2">"query"</span><span class="err">:</span> <span class="p">{</span><span class="s2">"$match"</span><span class="err">:</span><span class="p">{</span><span class="s2">"capRanId"</span><span class="err">:</span> <span class="s2">"{param}"</span><span class="p">}}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="caching">Caching</h3>

<p>[TODO]</p>


	  <footer class="c-footer">
  <div class="u-cols u-wrapper">
    <div class="u-col u-col--1-2 u-col--1-4@medium u-padding">
      <h3 class="c-footer__title">Client engagement</h3>
      <p class="epsilon"><a href="mailto:makesomething@dadi.tech">makesomething@dadi.tech</a><br>
      +44 (0) 20 7205 2902</p>
    </div>
    <div class="u-col u-col--1-2 u-col--1-4@medium u-padding">
      <h3 class="c-footer__title">Media enquiries</h3>
      <p class="epsilon"><a href="mailto:press@dadi.tech">press@dadi.tech</a><br>
      +44 (0) 20 7205 2901</p>
    </div>
    <div class="u-col u-col--1-2 u-col--1-4@medium u-padding">
      <h3 class="c-footer__title">Careers</h3>
      <p class="epsilon"><a href="mailto:joinus@dadi.tech">joinus@dadi.tech</a><br>
      +44 (0) 20 7205 2903</p>
    </div>
    <div class="u-col u-col--1-2 u-col--1-4@medium u-padding">
      <h3 class="c-footer__title">Everything else</h3>
      <p class="epsilon"><a href="mailto:hi@dadi.tech">hi@dadi.tech</a><br>
      +44 (0) 20 7205 2900<br>
      <a href="http://twitter.com/dadi">@dadi</a></p>
    </div>
  </div>

  <div class="u-wrapper u-padding">
    <img src="/public/assets/img/dadi-full.png" height="24">
  </div>
</footer>

	</body>
</html>