<!DOCTYPE html>
<html>
	<head>
  <meta charset="utf-8">  
  <meta name="author" content="dadi.co">  
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Welcome</title>
  <link rel="stylesheet" type="text/css" href="/css/main.css">
</head>

	<body>

	  <header class="c-header c-header--acollapsed">
  <div class="c-header__inner-wrapper u-cols">
    <div class="u-col u-col--1-1 u-col--2-3@medium">
      <a href="/">
        <img class="c-header__logo" src="/public/assets/img/dadi.png" alt="DADI">
      </a>

      <h2 class="c-header__title">Developer support</h2>
      <p class="c-header__subtitle">Tutorials and documentation</p>    
    </div>

    <div class="c-header__top u-col u-col--1-1 u-col--1-3@medium">
      <ul class="c-header__links">
        <li class="c-header__link">
          <a href="http://twitter.com/dadi">@DADI</a>
        </li>
        <li class="c-header__link">
          <a href="mailto:dev@dadi.tech">dev@dadi.tech</a>
        </li>
      </ul>

      
    </div>    

    
      <div class="u-col u-col--1-1">
        <div class="c-combo">
  <label class="c-combo__item c-combo__item--expand c-text-field-container">
    <span class="c-text-field__icon fa fa-search"></span>
    <input class="c-text-field" type="text" placeholder="Search our help centre…" />
  </label>
  <button class="c-combo__item c-button c-button--blue" type="submit">Search</button>
</div>
      </div>
    
  </div>
</header>

	  <h2 id="events">Events</h2>

<h3 id="overview">Overview</h3>

<p>Events are server side Javascript that can add additional functionality to a page. Events can serve as a useful way to implement logic to a logicless Dust template.</p>

<ul>
  <li>Global Events</li>
  <li>Preload Events</li>
  <li>Filter Events</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>my-web/
  app/
    datasources/      
    events/           
      addAuthorInformation.js      # an Event file
    pages/            
</code></pre>
</div>

<h3 id="global-events">Global Events</h3>

<p>In main configuration file</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">globalEvents</span><span class="err">:</span> <span class="p">{</span>
  <span class="nl">doc</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
  <span class="nx">format</span><span class="err">:</span> <span class="nb">Array</span><span class="p">,</span>
  <span class="k">default</span><span class="err">:</span> <span class="p">[]</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="preload-events">Preload Events</h3>

<p>In page specification file</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="s2">"preloadEvents"</span><span class="err">:</span> <span class="p">[</span>
  <span class="s2">"preloadevent-one"</span>
<span class="p">]</span>
</code></pre>
</div>

<h3 id="filter-events">Filter Events</h3>

<p>In datasource specification file</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="s2">"filterEvent"</span><span class="err">:</span> <span class="s2">"filterevent-one"</span>
</code></pre>
</div>

<p>Use case:<br />
A developer would like count how many people clicked on a ‘plus’ button.</p>

<p>To achieve this he has to create a new event and attach it to the page where he has the ‘plus’ button.</p>

<p>The developer then implements a code in the event which will look for specific event (i.e. POST buttonpressed) and inside this he will increase a counter stored in a text file.</p>

<p>The developer then returns the updated counter number from the event which is made accessible within the Dust template.</p>

<p>Events are added to pages in the page specification.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"page"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Book Reviews"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A collection of book reviews."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"cache"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"route"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/reviews"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"template"</span><span class="p">:</span><span class="w"> </span><span class="s2">"book-reviews.dust"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"datasources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"books"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"events"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"addAuthorInformation"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>
</div>

<h4 id="sample-event-file">Sample event file</h4>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="cm">/* optional Node includes */</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"http"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">querystring</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'querystring'</span><span class="p">);</span>

<span class="cm">/* optional DADI Web includes */</span>
<span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'@dadi/web'</span><span class="p">).</span><span class="nx">Config</span><span class="p">;</span>

<span class="c1">// the `data` parameter contains the data already loaded by</span>
<span class="c1">// the page's datasources and any previous events that have fired</span>

<span class="kd">var</span> <span class="nx">Event</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{};</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">books</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">result</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">title</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">title</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">result</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">title</span><span class="p">:</span> <span class="s2">"Not found"</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// return a null error and the result</span>
  <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Event</span> <span class="o">=</span> <span class="nx">Event</span><span class="p">;</span>
</code></pre>
</div>


	  <footer class="c-footer">
  <div class="u-cols u-wrapper">
    <div class="u-col u-col--1-2 u-col--1-4@medium u-padding">
      <h3 class="c-footer__title">Client engagement</h3>
      <p class="epsilon"><a href="mailto:makesomething@dadi.tech">makesomething@dadi.tech</a><br>
      +44 (0) 20 7205 2902</p>
    </div>
    <div class="u-col u-col--1-2 u-col--1-4@medium u-padding">
      <h3 class="c-footer__title">Media enquiries</h3>
      <p class="epsilon"><a href="mailto:press@dadi.tech">press@dadi.tech</a><br>
      +44 (0) 20 7205 2901</p>
    </div>
    <div class="u-col u-col--1-2 u-col--1-4@medium u-padding">
      <h3 class="c-footer__title">Careers</h3>
      <p class="epsilon"><a href="mailto:joinus@dadi.tech">joinus@dadi.tech</a><br>
      +44 (0) 20 7205 2903</p>
    </div>
    <div class="u-col u-col--1-2 u-col--1-4@medium u-padding">
      <h3 class="c-footer__title">Everything else</h3>
      <p class="epsilon"><a href="mailto:hi@dadi.tech">hi@dadi.tech</a><br>
      +44 (0) 20 7205 2900<br>
      <a href="http://twitter.com/dadi">@dadi</a></p>
    </div>
  </div>

  <div class="u-wrapper u-padding">
    <img src="/public/assets/img/dadi-full.png" height="24">
  </div>
</footer>

	</body>
</html>