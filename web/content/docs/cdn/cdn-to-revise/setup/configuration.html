<h2 id="overview">Overview</h2>

<p>DADI CDN’s settings are defined in a configuration files mapped to environment variables. These are contained wihtin <code class="highlighter-rouge">/config</code>. An example file, containing all of the available configuration options can be found in <code class="highlighter-rouge">/config/config.development.json.sample</code>.</p>

<h2 id="config-options">Config options</h2>

<h3 id="server">server</h3>

<p>The <code class="highlighter-rouge">server.host</code> config is passed to node’s <code class="highlighter-rouge">server.listen</code> function<br />
http://nodejs.org/api/http.html#http_server_listen_port_hostname_backlog_callback</p>

<p>You should be able to set it to your IP as well, but depending on your hosting, that may be tricky. For example, on AWS you would have to use your private IP instead of your public IP (or use <code class="highlighter-rouge">0.0.0.0</code>).</p>

<p>The proper name should always resolve correctly. Alternately, you can set it to null, to accept connections on any IPv4 address.</p>

<p><strong>Example</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>"server": {
	"host": "0.0.0.0",
	"port": 3000
}
</code></pre>
</div>

<h3 id="images">images</h3>

<p>Source images can be called either locally, from an S3 bucket or remotely via a URL.</p>

<p><strong>Example #1: local directory</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>"images": {
	"directory": {
		"enabled": true,
		"path": "./images"
	},
	"s3": {
		"enabled": false,
		"accessKey": "",
		"secretKey": "",
		"bucketName": "",
		"region": ""
	},
	"remote": {
		"enabled": false,
		"path": ""
	}
}
</code></pre>
</div>

<p><strong>Example #2: S3 lookup</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>"images": {
	"directory": {
		"enabled": false,
		"path": ""
	},
	"s3": {
		"enabled": true,
		"accessKey": "GIWJBDJWBDKJBWDJKW",
		"secretKey": "JbdiwjgdiwdgiuHIHiwndinduNUNWUNSWuww",
		"bucketName": "image-testing",
		"region": "eu-west-1"
	},
	"remote": {
		"enabled": false,
		"path": ""
	}
}
</code></pre>
</div>

<p><strong>Example #3: remote lookup</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>"images": {
	"directory": {
		"enabled": false,
		"path": "./images"
	},
	"s3": {
		"enabled": false,
		"accessKey": "",
		"secretKey": "",
		"bucketName": "",
		"region": ""
	},
	"remote": {
		"enabled": true,
		"path": "http://dh.dev.dadi.technology:3001"
	}
}
</code></pre>
</div>

<h3 id="assets-javascriptcss">assets (JavaScript/CSS)</h3>

<p>Source assets (JavaScript/CSS) can be called either locally, from an S3 bucket or remotely via a URL.</p>

<p><strong>Example #1: local directory</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>"assets": {
	"directory": {
		"enabled": true,
		"path": "./public"
	},
	"s3": {
		"enabled": false,
		"accessKey": "",
		"secretKey": "",
		"bucketName": "",
		"region": ""
	},
	"remote": {
		"enabled": false,
		"path": ""
	}
}
</code></pre>
</div>

<p><strong>Example #2: S3 lookup</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>"assets": {
	"directory": {
		"enabled": false,
		"path": ""
	},
	"s3": {
		"enabled": true,
		"accessKey": "GIWJBDJWBDKJBWDJKW",
		"secretKey": "JbdiwjgdiwdgiuHIHiwndinduNUNWUNSWuww",
		"bucketName": "image-testing",
		"region": ""
	},
	"remote": {
		"enabled": false,
		"path": ""
	}
}
</code></pre>
</div>

<p><strong>Example #3: remote lookup</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>"assets": {
	"directory": {
		"enabled": false,
		"path": ""
	},
	"s3": {
		"enabled": false,
		"accessKey": "",
		"secretKey": "",
		"bucketName": "",
		"region": ""
	},
		"remote": {
		"enabled": true,
		"path": "http://somedomain.com:3001"
	}
}
</code></pre>
</div>

<h3 id="caching">caching</h3>

<p>DADI CDN’s cache can be set to be either local (held on disk [local filesystem]) or Redis. Redis is generally recommended as it provides an in memory cache which is substantially faster under load. Redis also allows multiple instances of DADI CDN to share a cache, ensuring consistency in delivery within a clustered environment.</p>

<p>The <code class="highlighter-rouge">ttl</code> setting defines the default Time To Live for cached images and assets in seconds. The setting is applied to invidiual images/assets at the point that they are first cached. Once the threshold is met, cached images and assets are expired, and a fresh copy is drawn from the source location.</p>

<p><strong>Example #1: local caching</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>"caching": {
	"ttl": 3600,
	"directory": {
		"enabled": true,
		"path": "./cache/"
	},
	"redis": {
		"enabled": false,
		"host": "",
		"port": 6379
	}
}
</code></pre>
</div>

<p><strong>Example #2: Redis cache</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>"caching": {
	"ttl": 3600,
	"directory": {
		"enabled": false,
		"path": ""
	},
	"redis": {
		"enabled": true,
		"host": "testing.qvhlji.ng.0001.euw1.cache.amazonaws.com",
		"port": 6379
	}
}
</code></pre>
</div>

<h2 id="clientcache">clientCache</h2>

<p>The clientCache defines the cache headers that are sent with images/assets delivered by DADI CDN. They enable you to offset load by making use of modern browsers local caching.</p>

<p>You can read more about <code class="highlighter-rouge">cacheControl</code> and <code class="highlighter-rouge">etag</code> <a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching?hl=en">here</a>.</p>

<p><strong>Example</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>"clientCache": {
	"cacheControl": "public, max-age=3600",
	"etag": "15f0fff99ed5aae4edffdd6496d7131f"
}
</code></pre>
</div>

<h3 id="security">security</h3>

<p>The security setting allows you to set a maximum width and height to generated images. This prevents the potentual for a DOS attack based on the repeated generation of super large images, which could push your platform offline by exhausting CPU and/or available memory.</p>

<p>You should set this to the maximum size of image required in your product.</p>

<p><strong>Example</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>"security": {
	"maxWidth": 2048,
	"maxHeight": 1024
}
</code></pre>
</div>

<h3 id="auth">auth</h3>

<p>DADI CDN’s internal API for cache invalidation uses two-legged OAuth. This configuration allows you to define a clientId and secret to secure the invalidation API.</p>

<p><strong>Example</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>"auth": {
	"clientId": "1235488",
	"secret": "asd544see68e52"
}
</code></pre>
</div>

<h3 id="cloudfront">cloudfront</h3>

<p>DADI CDN works seamlessly with Cloudfront, allowing it to plug directly into global infrastructure. The <code class="highlighter-rouge">clodfront</code> settings in <code class="highlighter-rouge">config.json</code> enable DADI CDN’s invalidation API to be chained directly with Cloudfront’s invalidation API, meaning that an invalidation request sent to DADI CDN will have the effect of invalidating the same files in your Cloudfront distribution.</p>

<p><strong>Example</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>"cloudfront": {
	"accessKey": "GIWJBDJWBDKJBWDJKW",
	"secretKey": "JbdiwjgdiwdgiuHIHiwndinduNUNWUNSWuww",
	"bucketName": "",
	"region": ""
}
</code></pre>
</div>

<h3 id="gzip">GZIP</h3>

<p>DADI CDN supports GZIP compression, providiing a simple, effective way to save bandwidth and speed up your product.</p>

<p><strong>Example</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>"gzip": true
</code></pre>
</div>

<h3 id="feedback">feedback</h3>

<p>With <code class="highlighter-rouge">feedbaack</code> set to <code class="highlighter-rouge">true</code>, DADI CDN will provide feedback directly to the console, enabling you monitor your installation. This is useful for intial setup and debugging. It should not be used in a proudction environment.</p>

<p><strong>Example</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>"feedback": true
</code></pre>
</div>
